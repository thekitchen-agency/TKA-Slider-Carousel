(function(f,k){typeof exports=="object"&&typeof module<"u"?module.exports=k(require("gsap"),require("gsap/Draggable")):typeof define=="function"&&define.amd?define(["gsap","gsap/Draggable"],k):(f=typeof globalThis<"u"?globalThis:f||self,f.TkaSlider=k(f.gsap,f.Draggable))})(this,(function(f,k){"use strict";class q{constructor(){this.events={}}on(o,s){return this.events[o]||(this.events[o]=[]),this.events[o].push(s),{off:()=>this.off(o,s)}}off(o,s){this.events[o]&&(this.events[o]=this.events[o].filter(p=>p!==s))}emit(o,s=null){this.events[o]&&this.events[o].forEach(p=>p(s))}}function P(t,o,s){return{root:null,track:null,slides:[],mount(){this.root=t.container,this.track=this.root.querySelector(".tka-slider__track"),this.root.classList.add(`tka-slider--${t.options.type}`),this.collectSlides()},collectSlides(){this.slides=Array.from(this.track.children)}}}function V(t,o,s){return{x:0,slideWidth:0,mount(){this.calculate(),window.addEventListener("resize",()=>{this.calculate(),s.emit("resize")})},calculate(){const{Html:e}=o,{perView:a,gap:i}=t.options,n=e.root.offsetWidth;this.slideWidth=(n-i*(a-1))/a,e.slides.forEach(c=>{c.style.width=`${this.slideWidth}px`,c.style.marginRight=`${i}px`}),t.log(`Track calculated: slideWidth=${this.slideWidth}`)},getCoordinate(e){const{gap:a}=t.options;return e*(this.slideWidth+a)-this.getOffset()},getOffset(){const{focusAt:e,gap:a}=t.options,{Html:i}=o;return e==="center"?i.root.offsetWidth/2-this.slideWidth/2:typeof e=="number"?e*(this.slideWidth+a):0}}}function $(t,o,s){return{tween:null,mount(){this.bind()},bind(){s.on("resize",()=>{this.to(t.state.index,{duration:0})})},to(e,a={}){const{Track:i,Html:n}=o,{animationDuration:c,animationEase:l,type:h}=t.options,g=a.duration!==void 0?a.duration:c/1e3,u=a.ease||l;if(this.tween&&this.tween.kill(),(h==="fade"||h==="fan")&&t.options.loop){const v=n.slides.length;e>=v&&(e=0),e<0&&(e=v-1)}if(t.state.index=e,t.state.animationDuration=g,h==="fade"||h==="fan"){s.emit("move",{x:0}),s.emit("move.after",{index:t.state.index});return}const S=i.getCoordinate(e);this.tween=f.to(n.track,{x:-S,duration:g,ease:u,onUpdate:()=>{s.emit("move",{x:f.getProperty(n.track,"x")})},onComplete:()=>{t.state.animationDuration=0;let v=!1;t.options.loop&&(v=this.loop(t.state.index)),v||s.emit("move.after",{index:t.state.index})}})},loop(e){const{Track:a,Html:i}=o,n=t.clonesCount||0,l=i.slides.length-n*2,h=.001;return e<n-h?(this.jump(e+l),!0):e>l+n-1+h?(this.jump(e-l),!0):!1},jump(e){const{Track:a,Html:i}=o,{type:n}=t.options;if(t.state.index=e,n==="fade"||n==="fan"){s.emit("move",{x:0,jump:!0}),s.emit("move.after",{index:e});return}const c=a.getCoordinate(e);f.set(i.track,{x:-c}),s.emit("move",{x:-c,jump:!0}),s.emit("move.after",{index:e})}}}function B(t,o,s){return{draggable:null,mount(){this.init()},init(){f.registerPlugin(k.Draggable);const{Html:e,Move:a,Track:i}=o,n=t.options.type==="fan",c=t.options.type==="fade";this.draggable=k.Draggable.create(e.track,{type:n?"x,y":"x",trigger:e.root,edgeResistance:.65,inertia:!0,onDragStart:()=>{t.state.isDragging=!0,a.tween&&a.tween.kill(),s.emit("drag.start")},onDrag:function(){const l=t.options.swipeThreshold||80;if(c||n){if(Math.sqrt(this.x*this.x+this.y*this.y)>l*3){this.endDrag();return}f.set(e.track,{x:0,y:0}),s.emit("drag",{x:this.x,y:this.y});return}s.emit("drag",{x:this.x})},onDragEnd:function(){if(t.state.isDragging=!1,c||n){f.set(e.track,{x:0,y:0});const S=t.options.swipeThreshold||80;Math.sqrt(this.x*this.x+this.y*this.y)>S?n?this.x>0?a.to(t.state.index-1):a.to(t.state.index+1):this.getDirection()==="left"?a.to(t.state.index+1):this.getDirection()==="right"&&a.to(t.state.index-1):s.emit("move",{x:0}),s.emit("drag.end");return}const l=this.x,h=i.slideWidth+t.options.gap,g=i.getOffset();let u=Math.round((g-l)/h);t.options.loop||(u=Math.max(0,Math.min(u,e.slides.length-1))),a.to(u)}})[0]},disable(){this.draggable&&this.draggable.disable()},enable(){this.draggable&&this.draggable.enable()}}}function F(t,o,s){return{items:[],mount(){t.options.loop&&t.options.type!=="fade"&&t.options.type!=="fan"?this.run():t.clonesCount=0},remove(){const{Html:e}=o;e.track.querySelectorAll(".tka-slider__slide--clone").forEach(i=>i.remove()),e.collectSlides()},run(){this.remove();const{Html:e}=o,{perView:a,breakpoints:i}=t.options;let n=a;i&&Object.values(i).forEach(u=>{u.perView>n&&(n=u.perView)});const c=Math.ceil(n),l=e.slides;t.clonesCount=c;const h=l.slice(0,c).map(u=>u.cloneNode(!0));l.slice(-c).map(u=>u.cloneNode(!0)).reverse().forEach(u=>{u.classList.add("tka-slider__slide--clone"),e.track.insertBefore(u,e.track.firstChild)}),h.forEach(u=>{u.classList.add("tka-slider__slide--clone"),e.track.appendChild(u)}),o.Html.collectSlides(),o.Track.calculate(),t.state.index+=c,t.log(`Cloned ${c} slides on each side.`)}}}function Y(t,o,s){return{mount(){this.bind(),this.update()},bind(){s.on("move.after",()=>{this.update()})},update(){const{Html:e}=o,{index:a}=t.state;e.slides.forEach((i,n)=>{n===a?i.classList.contains("is-active")||(i.classList.add("is-active"),s.emit("slide.active",{index:n,slide:i})):i.classList.contains("is-active")&&(i.classList.remove("is-active"),s.emit("slide.inactive",{index:n,slide:i}))})}}}function N(t,o,s){return{interval:null,mount(){t.options.autoplay&&(this.start(),this.bind())},bind(){const{Html:e}=o;t.options.hoverPause&&(e.root.addEventListener("mouseenter",()=>this.stop()),e.root.addEventListener("mouseleave",()=>this.start())),s.on("drag.start",()=>this.stop()),s.on("drag.end",()=>{t.options.autoplay&&this.start()})},start(){t.options.autoplay&&(this.stop(),this.interval=setInterval(()=>{const{Move:e}=o;e.to(t.state.index+1)},typeof t.options.autoplay=="number"?t.options.autoplay:3e3))},stop(){this.interval&&(clearInterval(this.interval),this.interval=null)}}}function G(t,o,s){return{prevItems:[],nextItems:[],mount(){this.bind()},bind(){const{Html:e}=o;e.root.querySelectorAll("[data-tka-control]").forEach(i=>{const n=i.getAttribute("data-tka-control");i.addEventListener("click",c=>{c.preventDefault(),this.move(n)}),n==="<"&&this.prevItems.push(i),n===">"&&this.nextItems.push(i)})},move(e){const{Move:a}=o,{index:i}=t.state;if(e===">")a.to(i+1);else if(e==="<")a.to(i-1);else if(e.startsWith("=")){let n=parseInt(e.substring(1));t.options.loop&&t.options.type==="slide"&&(n+=t.clonesCount||0),a.to(n)}}}}function Z(t,o,s){return{wrapper:null,items:[],mount(){this.bind(),this.render()},bind(){s.on("move.after",()=>{this.active()}),s.on("mount.after",()=>{this.render()})},render(){const{Html:e}=o,{perView:a,loop:i}=t.options;if(this.wrapper=e.root.querySelector("[data-tka-bullets]"),!this.wrapper)return;this.wrapper.innerHTML="",this.items=[];const n=i?e.slides.length-t.clonesCount*2:e.slides.length;for(let c=0;c<n;c++){const l=document.createElement("button");l.className="tka-bullet",l.setAttribute("data-tka-bullet",c),l.addEventListener("click",h=>{h.preventDefault();const g=i?c+t.clonesCount:c;o.Move.to(g)}),this.wrapper.appendChild(l),this.items.push(l)}this.active()},active(){if(!this.wrapper)return;const{loop:e}=t.options,{index:a}=t.state;let i=a;if(e){const n=o.Html.slides.length-t.clonesCount*2;i=(a-t.clonesCount)%n,i<0&&(i+=n)}this.items.forEach((n,c)=>{c===i?n.classList.add("is-active"):n.classList.remove("is-active")})}}}function K(t,o,s){return{isRevealed:!1,mount(){this.bind();const{type:e,revealOnMount:a}=t.options;a?(this.isRevealed=!0,setTimeout(()=>this.reveal(),50)):(this.isRevealed=!1,setTimeout(()=>{this.update(f.getProperty(o.Html.track,"x"),!0)},10))},reveal(){const{type:e}=t.options;if(this.isRevealed=!0,e==="fan"){this.update(0,!0);const a=o.Html.slides.map(i=>i.querySelector(".demo-slide")||i.children[0]).filter(Boolean);f.from(a,{y:100,rotation:0,opacity:0,scale:.9,duration:.8,stagger:.1,ease:"back.out(1.2)",onComplete:()=>this.update(0,!0)})}else this.update(f.getProperty(o.Html.track,"x"),!0)},bind(){s.on("move",({x:e,jump:a})=>{this.update(e,a)}),s.on("drag",({x:e,y:a})=>{this.update(e,!1,a)}),s.on("resize",()=>{this.update(f.getProperty(o.Html.track,"x"),!0)})},update(e,a=!1,i=0){const{Html:n,Track:c}=o,{type:l,scaleOnCenter:h,scaleAmount:g,scaleRange:u,gap:S,animationEase:v}=t.options,z=c.slideWidth+S,tt=a?0:t.state.animationDuration||0;n.slides.forEach((T,W)=>{let E=T.querySelector(".demo-slide")||T.children[0];if(!E)return;let M,_,m=W-t.state.index;const D=n.slides.length;t.options.loop&&(l==="fade"||l==="fan")&&(m=(W-t.state.index)%D,m>D/2&&(m-=D),m<-D/2&&(m+=D));const O=Math.abs(m);if(l==="fade"||l==="fan")M=O,_=m;else{const d=c.getCoordinate(W),x=e+d;M=Math.abs(x)/z,_=x/z}let y=1;if(h){const d=u||1;y=1-Math.min(M,d)/d*(1-g),y=Math.max(g,Math.min(1,y))}const r={overwrite:!0};if(l==="coverflow")r.rotationY=_*-30,r.z=M*-100,r.opacity=this.isRevealed?1-Math.min(M,2)*.2:0,r.scale=y;else if(l==="360"){const d=E.querySelector(".tka-360-container")||E,x=Array.from(d.children).filter(w=>w.classList.contains("tka-360-frame")||d.children.length>1),A=x.length;if(A>1){const w=t.options.rotationSpeed||1;let b=Math.round(-_*w)%A;b<0&&(b+=A),d._tka_last_frame!==b&&(x.forEach((C,j)=>{const H=j===b;C.style.opacity=H?"1":"0",C.style.visibility=H?"visible":"hidden",C.style.zIndex=H?"2":"1"}),d._tka_last_frame=b)}r.scale=y,r.opacity=this.isRevealed?1:0,r.x=0,r.y=0,r.rotationY=0}else if(l==="fade"||l==="fan"){if(l==="fade")r.opacity=this.isRevealed?Math.max(0,1-O):0,r.scale=y,r.z=0,r.x=0,r.y=0,r.rotation=0;else if(l==="fan"){const d=t.options.rotateFactor||15,x=t.options.scaleFactor||.1,A=t.options.fanTranslateY||5,w=t.options.fanSpace||160,b=t.options.fanTilt||15,C=t.options.fanTranslateZ||-100,j=t.options.activeRotation||0,H=t.options.activeScale!==void 0?t.options.activeScale:1,et=t.options.activeTranslateY||0;if(m===0)r.rotation=(t.state.isDragging?e/15:0)+j,r.rotationY=t.state.isDragging?e/8:0,r.rotationX=t.state.isDragging?-i/8:0,r.x=e,r.y=i+et,r.opacity=this.isRevealed?1:0,r.scale=H,r.z=150;else if(O===1){const I=m===1,L=t.state.isDragging?.2:0;r.scale=1-x,r.y=A+i*L,r.opacity=this.isRevealed?.9:0,r.z=C,r.rotationX=-5+i/20*L,r.x=(I?w:-w)+e*L,r.rotation=(I?d:-d)+e/10*L,r.rotationY=(I?b:-b)+e/20*L}else r.opacity=0,r.z=-300,r.scale=.5,r.x=(m>0?1:-1)*300,r.y=0;r.ease=t.options.fanEase||"power2.out",T.style.zIndex=m===0?20:10-O}}else r.scale=y,r.opacity=this.isRevealed?h&&y<1?.6:1:0,r.rotationY=0,r.z=0,r.rotation=0,r.x=0,r.y=0;W===t.state.index?T.classList.add("is-active"):T.classList.remove("is-active"),r.duration=tt,r.ease||(r.ease=v),a?f.set(E,r):f.to(E,r)})}}}function U(t,o,s){return{originalOptions:null,mount(){this.originalOptions=Object.assign({},t.options),this.bind(),this.check()},bind(){window.addEventListener("resize",()=>{this.check()})},check(){const{breakpoints:e}=this.originalOptions;if(!e||Object.keys(e).length===0)return;const a=window.innerWidth;let i=null;const n=Object.keys(e).map(Number).sort((l,h)=>h-l);for(const l of n)a<=l&&(i=e[l]);const c=i?Object.assign({},this.originalOptions,i):this.originalOptions;(c.perView!==t.options.perView||c.gap!==t.options.gap||c.focusAt!==t.options.focusAt)&&this.apply(c)},apply(e){t.log("Applying breakpoint options:",e),t.options=Object.assign(t.options,e),o.Track&&o.Track.calculate(),o.Clones,o.Move&&o.Move.jump(t.state.index),s.emit("breakpoint.change",e)}}}function J(t,o,s){return{mount(){this.applyLabels(),t.options.keyboard&&this.bind()},bind(){const{Html:e}=o;e.root.setAttribute("tabindex","0"),e.root.addEventListener("keydown",a=>{const{Move:i}=o;a.key==="ArrowRight"?i.to(t.state.index+1):a.key==="ArrowLeft"&&i.to(t.state.index-1)})},applyLabels(){const{Html:e}=o,{loop:a}=t.options,i=t.clonesCount||0;e.root.setAttribute("role","region"),e.root.setAttribute("aria-label","Image Slider"),e.track.setAttribute("role","list"),e.slides.forEach((n,c)=>{let l=c;if(a){const h=e.slides.length-i*2;l=(c-i)%h,l<0&&(l+=h)}n.setAttribute("role","listitem"),n.setAttribute("aria-label",`Slide ${l+1}`)}),s.on("move.after",({index:n})=>{e.slides.forEach((c,l)=>{l===n?c.setAttribute("aria-hidden","false"):c.setAttribute("aria-hidden","true")})})}}}function Q(t,o,s){return{el:null,mount(){if(!t.options.pagination)return;const{Html:e}=o;this.el=typeof t.options.pagination=="string"?e.root.querySelector(t.options.pagination):e.root.querySelector("[data-tka-pagination]"),this.el&&(this.bind(),this.update())},bind(){s.on("move.after",()=>this.update())},update(){if(!this.el)return;const{Html:e}=o,{perView:a,loop:i}=t.options,n=i?e.slides.length-t.clonesCount*2:e.slides.length;let c=t.state.index;i&&(c=(t.state.index-t.clonesCount)%n,c<0&&(c+=n)),this.el.innerText=`${c+1} / ${n}`}}}const X={Html:P,Track:V,Move:$,Drag:B,Clones:F,Classes:Y,Autoplay:N,Controls:G,Bullets:Z,Effects:K,Breakpoints:U,A11y:J,Pagination:Q};class R{constructor(o,s={}){this.selector=o,this.options=Object.assign(R.defaults,s),this.events=new q,this.state={index:0,isDragging:!1,animationDuration:0},this.clonesCount=0,this.components={},this.init()}static get defaults(){return{startAt:0,perView:1,focusAt:0,gap:0,loop:!1,autoplay:!1,hoverPause:!0,type:"slide",animationDuration:600,animationEase:"power2.out",pagination:!1,keyboard:!0,scaleGradual:!1,rotateFactor:15,scaleFactor:.1,fanTranslateY:5,fanSpace:160,activeRotation:0,activeScale:1,activeTranslateY:0,breakpoints:{},swipeThreshold:80,debug:!1,revealOnMount:!0}}init(){if(this.log("Initializing slider..."),this.container=typeof this.selector=="string"?document.querySelector(this.selector):this.selector,!this.container){console.error(`[TkaSlider] Container not found: ${this.selector}`);return}if(this.container.tka_slider)return this.log("Slider already attached to this element. Returning existing instance."),this.container.tka_slider;this.container.tka_slider=this,this.log("Slider initialized.")}log(...o){this.options.debug&&console.log("[TkaSlider]",...o)}mount(){if(this._isMounted)return this.log("Slider already mounted. Skipping."),this;this.events.emit("mount.before"),this._components=Object.assign({},X,this.options.components);for(const o in this._components)typeof this._components[o]=="function"&&(this.components[o]=this._components[o](this,this.components,this.events));for(const o in this.components)this.components[o].mount&&this.components[o].mount();if(this._isMounted=!0,this.events.emit("mount.after"),this.components.Move){const o=this.options.startAt+(this.options.loop&&this.clonesCount||0);this.components.Move.jump(o)}return this}register(o){return this.options.components=Object.assign({},this.options.components,o),this}on(o,s){return this.events.on(o,s)}reveal(){return this.components.Effects&&this.components.Effects.reveal&&this.components.Effects.reveal(),this}go(o){if(this.components.Controls){const s=typeof o=="number"?`=${o}`:o;this.components.Controls.move(s)}return this}jump(o){let s=o;return this.options.loop&&this.options.type==="slide"&&(s+=this.clonesCount||0),this.components.Move&&this.components.Move.jump(s),this}}return R}));
