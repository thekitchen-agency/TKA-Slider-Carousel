(function(u,b){typeof exports=="object"&&typeof module<"u"?module.exports=b(require("gsap"),require("gsap/Draggable")):typeof define=="function"&&define.amd?define(["gsap","gsap/Draggable"],b):(u=typeof globalThis<"u"?globalThis:u||self,u.TkaSlider=b(u.gsap,u.Draggable))})(this,(function(u,b){"use strict";class j{constructor(){this.events={}}on(o,a){return this.events[o]||(this.events[o]=[]),this.events[o].push(a),{off:()=>this.off(o,a)}}off(o,a){this.events[o]&&(this.events[o]=this.events[o].filter(p=>p!==a))}emit(o,a=null){this.events[o]&&this.events[o].forEach(p=>p(a))}}function I(t,o,a){return{root:null,track:null,slides:[],mount(){this.root=t.container,this.track=this.root.querySelector(".tka-slider__track"),this.root.classList.add(`tka-slider--${t.options.type}`),this.collectSlides()},collectSlides(){this.slides=Array.from(this.track.children)}}}function _(t,o,a){return{x:0,slideWidth:0,mount(){this.calculate(),window.addEventListener("resize",()=>{this.calculate(),a.emit("resize")})},calculate(){const{Html:e}=o,{perView:s,gap:i}=t.options,n=e.root.offsetWidth;this.slideWidth=(n-i*(s-1))/s,e.slides.forEach(r=>{r.style.width=`${this.slideWidth}px`,r.style.marginRight=`${i}px`}),t.log(`Track calculated: slideWidth=${this.slideWidth}`)},getCoordinate(e){const{gap:s}=t.options;return e*(this.slideWidth+s)-this.getOffset()},getOffset(){const{focusAt:e,gap:s}=t.options,{Html:i}=o;return e==="center"?i.root.offsetWidth/2-this.slideWidth/2:typeof e=="number"?e*(this.slideWidth+s):0}}}function z(t,o,a){return{tween:null,mount(){this.bind()},bind(){a.on("resize",()=>{this.to(t.state.index,{duration:0})})},to(e,s={}){const{Track:i,Html:n}=o,{animationDuration:r,animationEase:l,type:h}=t.options,d=s.duration!==void 0?s.duration:r/1e3,f=s.ease||l;if(this.tween&&this.tween.kill(),(h==="fade"||h==="fan")&&t.options.loop){const g=n.slides.length;e>=g&&(e=0),e<0&&(e=g-1)}if(t.state.index=e,t.state.animationDuration=d,h==="fade"||h==="fan"){a.emit("move",{x:0}),a.emit("move.after",{index:t.state.index});return}const T=i.getCoordinate(e);this.tween=u.to(n.track,{x:-T,duration:d,ease:f,onUpdate:()=>{a.emit("move",{x:u.getProperty(n.track,"x")})},onComplete:()=>{t.state.animationDuration=0;let g=!1;t.options.loop&&(g=this.loop(t.state.index)),g||a.emit("move.after",{index:t.state.index})}})},loop(e){const{Track:s,Html:i}=o,n=t.clonesCount||0,l=i.slides.length-n*2,h=.001;return e<n-h?(this.jump(e+l),!0):e>l+n-1+h?(this.jump(e-l),!0):!1},jump(e){const{Track:s,Html:i}=o,{type:n}=t.options;if(t.state.index=e,n==="fade"||n==="fan"){a.emit("move",{x:0,jump:!0}),a.emit("move.after",{index:e});return}const r=s.getCoordinate(e);u.set(i.track,{x:-r}),a.emit("move",{x:-r,jump:!0}),a.emit("move.after",{index:e})}}}function q(t,o,a){return{draggable:null,mount(){this.init()},init(){u.registerPlugin(b.Draggable);const{Html:e,Move:s}=o,i=t.options.type==="fan",n=t.options.type==="fade";this.draggable=b.Draggable.create(e.track,{type:i?"x,y":"x",trigger:e.root,edgeResistance:.65,inertia:!0,onDragStart:()=>{t.state.isDragging=!0,s.tween&&s.tween.kill(),a.emit("drag.start")},onDrag:function(){const r=t.options.swipeThreshold||80;if(n||i){if(Math.sqrt(this.x*this.x+this.y*this.y)>r*3){this.endDrag();return}u.set(e.track,{x:0,y:0}),a.emit("drag",{x:this.x,y:this.y});return}a.emit("drag",{x:this.x})},onDragEnd:function(){if(t.state.isDragging=!1,n||i){u.set(e.track,{x:0,y:0});const f=t.options.swipeThreshold||80;Math.sqrt(this.x*this.x+this.y*this.y)>f?i?this.x>0?s.to(t.state.index-1):s.to(t.state.index+1):this.getDirection()==="left"?s.to(t.state.index+1):this.getDirection()==="right"&&s.to(t.state.index-1):a.emit("move",{x:0}),a.emit("drag.end");return}const r=this.x,l=Track.slideWidth+t.options.gap,h=Track.getOffset();let d=Math.round((h-r)/l);t.options.loop||(d=Math.max(0,Math.min(d,e.slides.length-1))),s.to(d)}})[0]},disable(){this.draggable&&this.draggable.disable()},enable(){this.draggable&&this.draggable.enable()}}}function P(t,o,a){return{items:[],mount(){t.options.loop&&t.options.type!=="fade"&&t.options.type!=="fan"?this.run():t.clonesCount=0},remove(){const{Html:e}=o;e.track.querySelectorAll(".tka-slider__slide--clone").forEach(i=>i.remove()),e.collectSlides()},run(){this.remove();const{Html:e}=o,{perView:s,breakpoints:i}=t.options;let n=s;i&&Object.values(i).forEach(f=>{f.perView>n&&(n=f.perView)});const r=Math.ceil(n),l=e.slides;t.clonesCount=r;const h=l.slice(0,r).map(f=>f.cloneNode(!0));l.slice(-r).map(f=>f.cloneNode(!0)).reverse().forEach(f=>{f.classList.add("tka-slider__slide--clone"),e.track.insertBefore(f,e.track.firstChild)}),h.forEach(f=>{f.classList.add("tka-slider__slide--clone"),e.track.appendChild(f)}),o.Html.collectSlides(),o.Track.calculate(),t.state.index+=r,t.log(`Cloned ${r} slides on each side.`)}}}function V(t,o,a){return{mount(){this.bind(),this.update()},bind(){a.on("move.after",()=>{this.update()})},update(){const{Html:e}=o,{index:s}=t.state;e.slides.forEach((i,n)=>{n===s?i.classList.contains("is-active")||(i.classList.add("is-active"),a.emit("slide.active",{index:n,slide:i})):i.classList.contains("is-active")&&(i.classList.remove("is-active"),a.emit("slide.inactive",{index:n,slide:i}))})}}}function $(t,o,a){return{interval:null,mount(){t.options.autoplay&&(this.start(),this.bind())},bind(){const{Html:e}=o;t.options.hoverPause&&(e.root.addEventListener("mouseenter",()=>this.stop()),e.root.addEventListener("mouseleave",()=>this.start())),a.on("drag.start",()=>this.stop()),a.on("drag.end",()=>{t.options.autoplay&&this.start()})},start(){t.options.autoplay&&(this.stop(),this.interval=setInterval(()=>{const{Move:e}=o;e.to(t.state.index+1)},typeof t.options.autoplay=="number"?t.options.autoplay:3e3))},stop(){this.interval&&(clearInterval(this.interval),this.interval=null)}}}function B(t,o,a){return{prevItems:[],nextItems:[],mount(){this.bind()},bind(){const{Html:e}=o;e.root.querySelectorAll("[data-tka-control]").forEach(i=>{const n=i.getAttribute("data-tka-control");i.addEventListener("click",r=>{r.preventDefault(),this.move(n)}),n==="<"&&this.prevItems.push(i),n===">"&&this.nextItems.push(i)})},move(e){const{Move:s}=o,{index:i}=t.state;if(e===">")s.to(i+1);else if(e==="<")s.to(i-1);else if(e.startsWith("=")){const n=parseInt(e.substring(1));s.to(n)}}}}function F(t,o,a){return{wrapper:null,items:[],mount(){this.bind(),this.render()},bind(){a.on("move.after",()=>{this.active()}),a.on("mount.after",()=>{this.render()})},render(){const{Html:e}=o,{perView:s,loop:i}=t.options;if(this.wrapper=e.root.querySelector("[data-tka-bullets]"),!this.wrapper)return;this.wrapper.innerHTML="",this.items=[];const n=i?e.slides.length-t.clonesCount*2:e.slides.length;for(let r=0;r<n;r++){const l=document.createElement("button");l.className="tka-bullet",l.setAttribute("data-tka-bullet",r),l.addEventListener("click",h=>{h.preventDefault();const d=i?r+t.clonesCount:r;o.Move.to(d)}),this.wrapper.appendChild(l),this.items.push(l)}this.active()},active(){if(!this.wrapper)return;const{loop:e}=t.options,{index:s}=t.state;let i=s;if(e){const n=o.Html.slides.length-t.clonesCount*2;i=(s-t.clonesCount)%n,i<0&&(i+=n)}this.items.forEach((n,r)=>{r===i?n.classList.add("is-active"):n.classList.remove("is-active")})}}}function Y(t,o,a){return{isRevealed:!1,mount(){this.bind();const{type:e,revealOnMount:s}=t.options;s?(this.isRevealed=!0,setTimeout(()=>this.reveal(),50)):(this.isRevealed=!1,setTimeout(()=>{this.update(u.getProperty(o.Html.track,"x"),!0)},10))},reveal(){const{type:e}=t.options;if(this.isRevealed=!0,e==="fan"){this.update(0,!0);const s=o.Html.slides.map(i=>i.querySelector(".demo-slide")).filter(Boolean);u.from(s,{y:100,rotation:0,opacity:0,scale:.9,duration:.8,stagger:.1,ease:"back.out(1.2)",onComplete:()=>this.update(0,!0)})}else this.update(u.getProperty(o.Html.track,"x"),!0)},bind(){a.on("move",({x:e,jump:s})=>{this.update(e,s)}),a.on("drag",({x:e,y:s})=>{this.update(e,!1,s)}),a.on("resize",()=>{this.update(u.getProperty(o.Html.track,"x"),!0)})},update(e,s=!1,i=0){const{Html:n,Track:r}=o,{type:l,scaleOnCenter:h,scaleAmount:d,scaleRange:f,gap:T,animationEase:g}=t.options,W=r.slideWidth+T,U=s?0:t.state.animationDuration||0;n.slides.forEach((E,D)=>{const H=E.querySelector(".demo-slide");if(!H)return;let x,C,m=D-t.state.index;const k=n.slides.length;t.options.loop&&(l==="fade"||l==="fan")&&(m=(D-t.state.index)%k,m>k/2&&(m-=k),m<-k/2&&(m+=k));const S=Math.abs(m);if(l==="fade"||l==="fan")x=S,C=m;else{const y=r.getCoordinate(D),M=e+y;x=Math.abs(M)/W,C=M/W}let v=1;if(h){const y=f||1;v=1-Math.min(x,y)/y*(1-d),v=Math.max(d,Math.min(1,v))}const c={overwrite:!0};if(l==="coverflow")c.rotationY=C*-30,c.z=x*-100,c.opacity=this.isRevealed?1-Math.min(x,2)*.2:0,c.scale=v;else if(l==="fade"||l==="fan"){if(l==="fade")c.opacity=this.isRevealed?Math.max(0,1-S):0,c.scale=v,c.z=0,c.x=0,c.y=0,c.rotation=0;else if(l==="fan"){const y=t.options.rotateFactor||15,M=t.options.scaleFactor||.1,J=t.options.fanTranslateY||5,O=t.options.fanSpace||160,R=t.options.fanTilt||15,Q=t.options.fanTranslateZ||-100,X=t.options.activeRotation||0,tt=t.options.activeScale!==void 0?t.options.activeScale:1,et=t.options.activeTranslateY||0;if(m===0)c.rotation=(t.state.isDragging?e/15:0)+X,c.rotationY=t.state.isDragging?e/8:0,c.rotationX=t.state.isDragging?-i/8:0,c.x=e,c.y=i+et,c.opacity=this.isRevealed?1:0,c.scale=tt,c.z=150;else if(S===1){const L=m===1,w=t.state.isDragging?.2:0;c.scale=1-M,c.y=J+i*w,c.opacity=this.isRevealed?.9:0,c.z=Q,c.rotationX=-5+i/20*w,c.x=(L?O:-O)+e*w,c.rotation=(L?y:-y)+e/10*w,c.rotationY=(L?R:-R)+e/20*w}else c.opacity=0,c.z=-300,c.scale=.5,c.x=(m>0?1:-1)*300,c.y=0;c.ease=t.options.fanEase||"power2.out",E.style.zIndex=m===0?20:10-S}}else c.scale=v,c.opacity=this.isRevealed?h&&v<1?.6:1:0,c.rotationY=0,c.z=0,c.rotation=0,c.x=0,c.y=0;D===t.state.index?E.classList.add("is-active"):E.classList.remove("is-active"),c.duration=U,c.ease||(c.ease=g),s?u.set(H,c):u.to(H,c)})}}}function N(t,o,a){return{originalOptions:null,mount(){this.originalOptions=Object.assign({},t.options),this.bind(),this.check()},bind(){window.addEventListener("resize",()=>{this.check()})},check(){const{breakpoints:e}=this.originalOptions;if(!e||Object.keys(e).length===0)return;const s=window.innerWidth;let i=null;const n=Object.keys(e).map(Number).sort((l,h)=>h-l);for(const l of n)s<=l&&(i=e[l]);const r=i?Object.assign({},this.originalOptions,i):this.originalOptions;(r.perView!==t.options.perView||r.gap!==t.options.gap||r.focusAt!==t.options.focusAt)&&this.apply(r)},apply(e){t.log("Applying breakpoint options:",e),t.options=Object.assign(t.options,e),o.Track&&o.Track.calculate(),o.Clones,o.Move&&o.Move.jump(t.state.index),a.emit("breakpoint.change",e)}}}function G(t,o,a){return{mount(){this.applyLabels(),t.options.keyboard&&this.bind()},bind(){const{Html:e}=o;e.root.setAttribute("tabindex","0"),e.root.addEventListener("keydown",s=>{const{Move:i}=o;s.key==="ArrowRight"?i.to(t.state.index+1):s.key==="ArrowLeft"&&i.to(t.state.index-1)})},applyLabels(){const{Html:e}=o,{loop:s}=t.options,i=t.clonesCount||0;e.root.setAttribute("role","region"),e.root.setAttribute("aria-label","Image Slider"),e.track.setAttribute("role","list"),e.slides.forEach((n,r)=>{let l=r;if(s){const h=e.slides.length-i*2;l=(r-i)%h,l<0&&(l+=h)}n.setAttribute("role","listitem"),n.setAttribute("aria-label",`Slide ${l+1}`)}),a.on("move.after",({index:n})=>{e.slides.forEach((r,l)=>{l===n?r.setAttribute("aria-hidden","false"):r.setAttribute("aria-hidden","true")})})}}}function Z(t,o,a){return{el:null,mount(){if(!t.options.pagination)return;const{Html:e}=o;this.el=typeof t.options.pagination=="string"?e.root.querySelector(t.options.pagination):e.root.querySelector("[data-tka-pagination]"),this.el&&(this.bind(),this.update())},bind(){a.on("move.after",()=>this.update())},update(){if(!this.el)return;const{Html:e}=o,{perView:s,loop:i}=t.options,n=i?e.slides.length-t.clonesCount*2:e.slides.length;let r=t.state.index;i&&(r=(t.state.index-t.clonesCount)%n,r<0&&(r+=n)),this.el.innerText=`${r+1} / ${n}`}}}const K={Html:I,Track:_,Move:z,Drag:q,Clones:P,Classes:V,Autoplay:$,Controls:B,Bullets:F,Effects:Y,Breakpoints:N,A11y:G,Pagination:Z};class A{constructor(o,a={}){this.selector=o,this.options=Object.assign(A.defaults,a),this.events=new j,this.state={index:0,isDragging:!1,animationDuration:0},this.clonesCount=0,this.components={},this.init()}static get defaults(){return{startAt:0,perView:1,focusAt:0,gap:0,loop:!1,autoplay:!1,hoverPause:!0,type:"slide",animationDuration:600,animationEase:"power2.out",pagination:!1,keyboard:!0,scaleGradual:!1,rotateFactor:15,scaleFactor:.1,fanTranslateY:5,fanSpace:160,activeRotation:0,activeScale:1,activeTranslateY:0,breakpoints:{},swipeThreshold:80,debug:!1,revealOnMount:!0}}init(){if(this.log("Initializing slider..."),this.container=typeof this.selector=="string"?document.querySelector(this.selector):this.selector,!this.container){console.error(`[TkaSlider] Container not found: ${this.selector}`);return}if(this.container.tka_slider)return this.log("Slider already attached to this element. Returning existing instance."),this.container.tka_slider;this.container.tka_slider=this,this.log("Slider initialized.")}log(...o){this.options.debug&&console.log("[TkaSlider]",...o)}mount(){if(this._isMounted)return this.log("Slider already mounted. Skipping."),this;this.events.emit("mount.before"),this._components=Object.assign({},K,this.options.components);for(const o in this._components)typeof this._components[o]=="function"&&(this.components[o]=this._components[o](this,this.components,this.events));for(const o in this.components)this.components[o].mount&&this.components[o].mount();if(this._isMounted=!0,this.events.emit("mount.after"),this.components.Move){const o=this.options.startAt+(this.options.loop&&this.clonesCount||0);this.components.Move.jump(o)}return this}register(o){return this.options.components=Object.assign({},this.options.components,o),this}on(o,a){return this.events.on(o,a)}reveal(){return this.components.Effects&&this.components.Effects.reveal&&this.components.Effects.reveal(),this}}return A}));
